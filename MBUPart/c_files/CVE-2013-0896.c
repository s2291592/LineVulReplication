  TestConnection(QuicGuid guid,
                 IPEndPoint address,
                 QuicConnectionHelper* helper)
      : QuicConnection(guid, address, helper) {
  }

  bool SendPacket(QuicPacketSequenceNumber sequence_number,
                  QuicPacket* packet,
                  bool resend,
                  bool force) {
    return QuicConnection::SendPacket(sequence_number, packet, resend, force);
  }

  virtual int WritePacketToWire(QuicPacketSequenceNumber number,
                                const QuicEncryptedPacket& packet,
                                bool resend,
                                int* error) {
    QuicFramer framer(QuicDecrypter::Create(kNULL),
                      QuicEncrypter::Create(kNULL));
    FramerVisitorCapturingAcks visitor;
    framer.set_visitor(&visitor);
    EXPECT_TRUE(framer.ProcessPacket(IPEndPoint(), IPEndPoint(), packet));
    header_ = *visitor.header();
    return packet.length();
  }

  static void SendAck(QuicConnection* connection) {
    connection->SendAck();
  }

  void SetScheduler(QuicSendScheduler* scheduler) {
    QuicConnectionPeer::SetScheduler(this, scheduler);
  }

   QuicPacket* ConstructDataPacket(QuicPacketSequenceNumber number,
                                   QuicFecGroupNumber fec_group) {
     header_.packet_sequence_number = number;
     header_.flags = PACKET_FLAGS_NONE;
     header_.fec_group = fec_group;
 
    QuicFrames frames;
    QuicFrame frame(&frame1_);
    frames.push_back(frame);
    QuicPacket* packet;
    framer_.ConstructFragementDataPacket(header_, frames, &packet);
    return packet;
  }

QuicConnectionHelperTest()
      : framer_(QuicDecrypter::Create(kNULL), QuicEncrypter::Create(kNULL)),
creator_(guid_, &framer_),
net_log_(BoundNetLog()),
scheduler_(new MockScheduler()),
socket_(&empty_data_, net_log_.net_log()),
runner_(new TestTaskRunner(&clock_)),
helper_(new TestConnectionHelper(runner_.get(), &clock_, &socket_)),
connection_(guid_, IPEndPoint(), helper_),
frame1_(1, false, 0, data1) {
connection_.set_visitor(&visitor_);
connection_.SetScheduler(scheduler_);
}

  void SendAck() {
    QuicConnectionPeer::SendAck(this);
  }
